<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bandeali Enterprises Treasure Box</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
    body {
      margin: 0; padding: 0;
      background: radial-gradient(circle at 60% 50%, #283445 0%, #181e27 100%);
      font-family: 'Orbitron', sans-serif;
      color: white;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      user-select: none;
    }
    .header-container {
      width: 100%; text-align: center;
    }
    h1 {
      margin: 30px 0 12px; font-size: 2rem;
      color: #fde260;
      text-shadow: 0 0 12px #fde260, 0 2px 18px #000;
      font-weight: bold;
      letter-spacing: 2px;
    }
    #instructions {
      margin: 0 18px 32px 18px;
      font-size: 1.15rem;
      color: #efefef;
      max-width: 500px;
      line-height: 1.5;
      text-align: center;
      letter-spacing: 1px;
      background: rgba(0,0,0,0.14);
      border-radius: 15px;
      padding: 8px 0;
    }
    #game-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-gap: 18px 14px;
      justify-items: center;
      width: 96vw;
      max-width: 330px;
      margin: 18px auto 0 auto;
      min-height: 340px;
    }
    .box {
      width: 70px;
      height: 90px;
      background: linear-gradient(145deg, #6b3e00, #3d2300 92%);
      border: 2.5px solid #fde260;
      border-radius: 11px;
      box-shadow: 0 0 13px #fde26075 inset, 0 2px 8px #000b;
      cursor: pointer;
      font-size: 2rem;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.22s;
      outline: none;
      user-select: none;
      position: relative;
      color: #fde260;
      font-weight: bold;
    }
    .box.locked {
      filter: grayscale(1) blur(0.5px); opacity: 0.6; cursor: default;
    }
    .box.opened {
      background: #fde260;
      color: #2d1a00;
      cursor: default;
      filter: none;
      opacity: 1;
      box-shadow: 0 0 25px #fde260cc;
      transform: scale(1.06);
    }
    .box .chest-img {
      max-width: 42px; max-height: 44px; margin: 0 auto; display: block;
      filter: drop-shadow(0 0 2px #fff98e) drop-shadow(0 0 6px #fde26093);
    }
    .box .result-text {
      font-size: 0.72rem;
      font-weight: 900;
      color: #a67c07;
      letter-spacing:.2px;
      margin-top: 2px;
    }
    #spin-button {
      display: none;
      margin: 26px auto 18px auto;
      padding: 11px 30px;
      font-size: 1.17rem;
      border-radius: 24px;
      background: #fde260;
      color: #3a2b0d;
      border: none;
      cursor: pointer;
      font-weight: 900;
      box-shadow: 0 0 15px #fde260aa;
      user-select: none;
      transition: background 0.3s;
      letter-spacing: 1.2px;
    }
    #spin-button:hover { background: #fadc69;}
    #spin-button:active { background: #bca219; color: #fff;}
    #popup {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.93);
      display: none;
      z-index: 1200;
      align-items: center;
      flex-direction: column;
      color: white;
      font-size: 1.5rem;
      text-align: center;
      padding: 24px;
      justify-content: center;
    }
    #popup img {
      max-width: 110px;
      margin-bottom: 18px;
      filter: drop-shadow(0 0 10px #fde260);
      user-select: none;
    }
    #popup .popup-text {
      color: #fde260;
      font-weight: 700;
      line-height: 1.25;
      text-shadow: 0 0 12px #fde260;
      margin-bottom: 15px;
      font-size: 1.27rem;
    }
    #popup button {
      padding: 12px 32px;
      font-size: 1rem;
      border-radius: 10px;
      background: #fde260;
      border: none;
      font-weight: bold;
      color: #3a1f00;
      box-shadow: 0 0 10px #fde260;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #popup button:hover { background-color: #ffe88e;}
    #popup button:active { background-color: #bfa921; color: #222;}
    #fireworks {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 1199;
      display: none;
    }
    @media (max-width:600px){
      h1 { font-size: 1.15rem;}
      #instructions { font-size: 1rem; }
      #game-container { max-width: 97vw; grid-gap: 14px 6px; }
      .box { width: 48px; height: 62px; font-size: 1.25rem; }
      .box .result-text { font-size: 0.68rem;}
      #popup { font-size: 1.05rem; padding: 13px;}
      #popup img { max-width: 75px;}
    }
  </style>
</head>
<body>
  <div class="header-container">
    <h1>Bandeali Enterprises Treasure Box</h1>
    <div id="instructions">
      Choose a treasure box below and test your luck!
    </div>
  </div>
  <div id="game-container" aria-live="polite" aria-label="Treasure boxes"></div>
  <button id="spin-button" aria-label="Reveal all boxes">Reveal All</button>
  <div id="popup" role="dialog" aria-modal="true">
    <img src="treasure.png" alt="Treasure Chest" id="popup-img"/>
    <div class="popup-text" id="popup-text"></div>
    <button id="popup-close" aria-label="Close popup">OK</button>
  </div>
  <canvas id="fireworks"></canvas>
  <script>
    const prizes = [
      {win:true, text:"🔥 10% OFF"},
      {win:false, text:"Better luck next time!"},
      {win:true, text:"🎁 15% OFF"},
      {win:false, text:"Better luck next time!"},
      {win:true, text:"💸 20% OFF"},
      {win:false, text:"Better luck next time!"},
      {win:true, text:"🎉 ₹30 OFF"},
      {win:true, text:"🎧 Free Earphones"},
      {win:true, text:"💵 ₹50 Cashback"}
    ];

    const gameContainer = document.getElementById("game-container");
    const spinButton = document.getElementById("spin-button");
    const popup = document.getElementById("popup");
    const popupText = document.getElementById("popup-text");
    const popupClose = document.getElementById("popup-close");
    const popupImg = document.getElementById("popup-img");
    const fireworksCanvas = document.getElementById("fireworks");
    const ctx = fireworksCanvas.getContext("2d");

    let chosenIndex = null;
    let boxes = [];

    function shuffle(arr) {
      let array = [...arr];
      for (let i = array.length -1; i>0; i--) {
        let j = Math.floor(Math.random() * (i+1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function createBoxes() {
      gameContainer.innerHTML = '';
      chosenIndex = null;
      spinButton.style.display = 'none';
      boxes = [];
      // Shuffle prizes for randomness each round
      const shuffledPrizes = shuffle(prizes);

      for(let i=0; i<shuffledPrizes.length; i++) {
        const box = document.createElement('div');
        box.className = 'box';
        box.innerHTML = '<span>?</span>';
        box.setAttribute('data-index', i);
        box.tabIndex = 0;
        box.setAttribute('role','button');
        box.setAttribute('aria-pressed','false');
        box.addEventListener('click', onBoxSelect);
        box.addEventListener('keydown', function(e){
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onBoxSelect.call(this); }
        });
        gameContainer.appendChild(box);
        boxes.push({el:box, prize:shuffledPrizes[i]});
      }
    }

    function onBoxSelect() {
      if(chosenIndex !== null) return;
      chosenIndex = +this.getAttribute('data-index');
      boxes.forEach((box, idx) => {
        if(idx !== chosenIndex) {
          box.el.classList.add('locked');
          box.el.setAttribute('aria-pressed','false');
          box.el.tabIndex = -1;
        } else {
          box.el.classList.remove('locked');
          box.el.setAttribute('aria-pressed','true');
          box.el.focus();
        }
      });
      spinButton.style.display = 'block';
    }

    spinButton.addEventListener('click', revealAll);

    function revealAll() {
      boxes.forEach((box, idx) => {
        box.el.classList.remove('locked');
        box.el.classList.add('opened');
        box.el.tabIndex = -1;
        box.el.innerHTML = '';
        if (box.prize.win) {
          // Show treasure chest image and prize
          const img = document.createElement('img');
          img.src = 'treasure.png';
          img.alt = 'Treasure Box';
          img.className = 'chest-img';
          box.el.appendChild(img);
          const textDiv = document.createElement('div');
          textDiv.className = 'result-text';
          textDiv.textContent = box.prize.text;
          box.el.appendChild(textDiv);
        } else {
          // Only show "Better luck next time!"
          const textDiv = document.createElement('div');
          textDiv.className = 'result-text';
          textDiv.textContent = box.prize.text;
          box.el.appendChild(textDiv);
        }
      });
      spinButton.style.display = 'none';
      showPopup(boxes[chosenIndex].prize);
    }

    function showPopup(prize) {
      popupText.textContent = prize.text;
      popupImg.style.display = prize.win ? 'block' : 'none';
      popup.style.display = 'flex';
      launchFireworks();
    }

    popupClose.onclick = () => {
      popup.style.display = 'none';
      clearFireworks();
      createBoxes();
    };

    // Fireworks
    let fireworks = [];
    let fireworksAnim;
    function launchFireworks() {
      fireworksCanvas.width = window.innerWidth;
      fireworksCanvas.height = window.innerHeight;
      fireworksCanvas.style.display = 'block';
      fireworks = [];
      clearInterval(fireworksAnim);
      fireworksAnim = setInterval(() => {
        if (fireworks.length < 24) fireworks.push(new Firework());
      }, 250);
      renderFireworks();
    }
    function clearFireworks() {
      clearInterval(fireworksAnim);
      fireworks = [];
      ctx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
      fireworksCanvas.style.display = 'none';
    }
    class Firework {
      constructor() {
        this.x = Math.random() * fireworksCanvas.width;
        this.y = fireworksCanvas.height + 15;
        this.targetY = Math.random() * fireworksCanvas.height / 2;
        this.vy = -(7 + Math.random() * 3);
        this.exploded = false;
        this.particles = [];
        this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
      }
      update() {
        if (!this.exploded) {
          this.y += this.vy;
          this.vy += 0.16;
          if (this.vy >= 0) {
            this.exploded = true;
            for (let i = 0; i < 24; i++) {
              const angle = (2 * Math.PI / 24) * i;
              this.particles.push({
                x: this.x,
                y: this.y,
                vx: Math.cos(angle) * (2 + Math.random() * 2),
                vy: Math.sin(angle) * (2 + Math.random() * 2),
                alpha: 1,
                color: this.color,
              });
            }
          }
        } else {
          this.particles.forEach(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.05;
            p.alpha -= 0.02;
          });
          this.particles = this.particles.filter(p => p.alpha > 0);
        }
      }
      draw(ctx) {
        if (!this.exploded) {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 2.6, 0, 2 * Math.PI);
          ctx.fillStyle = this.color;
          ctx.fill();
        } else {
          this.particles.forEach(p => {
            ctx.globalAlpha = p.alpha;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 1.5, 0, 2 * Math.PI);
            ctx.fillStyle = p.color;
            ctx.fill();
            ctx.globalAlpha = 1;
          });
        }
      }
    }
    function renderFireworks() {
      ctx.clearRect(0,0,fireworksCanvas.width,fireworksCanvas.height);
      fireworks.forEach(fw => {
        fw.update();
        fw.draw(ctx);
      });
      if (fireworksCanvas.style.display === 'block') requestAnimationFrame(renderFireworks);
    }

    window.addEventListener('resize', () => {
      fireworksCanvas.width = window.innerWidth;
      fireworksCanvas.height = window.innerHeight;
    });
    window.onload = createBoxes;
  </script>
</body>
</html>
